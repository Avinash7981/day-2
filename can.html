<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Task Manager Pro - Ultimate Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --accent: #3b82f6;
            --border: #e5e7eb;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }
        
        [data-theme="dark"] {
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --accent: #60a5fa;
            --border: #374151;
        }
        
        [data-theme="colorful"] {
            --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-secondary: rgba(255, 255, 255, 0.95);
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --accent: #8b5cf6;
            --border: #e5e7eb;
        }
        
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .bg-primary { background: var(--bg-secondary); }
        .text-primary { color: var(--text-primary); }
        .text-secondary { color: var(--text-secondary); }
        .border-custom { border-color: var(--border); }
        
        .task-item {
            transition: all 0.3s ease;
            background: var(--bg-secondary);
            border-color: var(--border);
        }
        
        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .completed-task {
            opacity: 0.6;
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-out {
            animation: fadeOut 0.3s ease-out forwards;
        }
        
        @keyframes fadeOut {
            to { opacity: 0; transform: translateX(100px); }
        }
        
        .notification {
            animation: slideInRight 0.3s ease-out;
        }
        
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .priority-high { border-left: 4px solid var(--error); }
        .priority-medium { border-left: 4px solid var(--warning); }
        .priority-low { border-left: 4px solid var(--success); }
        
        .calendar-day {
            transition: all 0.2s ease;
            position: relative;
        }
        
        .calendar-day:hover {
            background-color: var(--accent);
            color: white;
        }
        
        .calendar-day.selected {
            background-color: var(--accent);
            color: white;
        }
        
        .calendar-day.has-tasks::after {
            content: '';
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 6px;
            height: 6px;
            background-color: var(--error);
            border-radius: 50%;
        }
        
        .modal {
            backdrop-filter: blur(10px);
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            transition: stroke-dashoffset 0.35s;
        }
        
        .widget {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .subtask-item {
            background: rgba(0, 0, 0, 0.02);
            border-radius: 8px;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-left: 2px solid var(--border);
        }
        
        .reminder-active {
            animation: reminderPulse 1s infinite;
        }
        
        @keyframes reminderPulse {
            0%, 100% { background-color: var(--bg-secondary); }
            50% { background-color: rgba(239, 68, 68, 0.1); }
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: var(--border);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .calendar-cell {
            background-color: var(--bg-secondary);
            padding: 0.75rem;
            min-height: 80px;
            position: relative;
        }
        
        .calendar-cell.other-month {
            opacity: 0.3;
        }
        
        .calendar-cell.today {
            background-color: rgba(59, 130, 246, 0.1);
        }
        
        .task-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin: 1px;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            border-radius: 6px;
            margin: 0.25rem 0;
            background: rgba(0, 0, 0, 0.02);
        }
        
        .time-tracker {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 8px;
            margin-top: 0.5rem;
        }
        
        .nav-tab {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .nav-tab.active {
            background-color: var(--accent);
            color: white;
        }
        
        .nav-tab:hover:not(.active) {
            background-color: rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="bg-primary border-b border-custom shadow-sm sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-bold text-primary">üöÄ Task Manager Pro Ultimate</h1>
                    <div class="hidden md:flex items-center space-x-2">
                        <span class="text-sm text-secondary">Theme:</span>
                        <select id="themeSelector" class="bg-primary border border-custom rounded-md px-2 py-1 text-sm">
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                            <option value="colorful">Colorful</option>
                        </select>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="reminderBtn" class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded-lg font-medium transition-colors text-sm">
                        üîî <span id="reminderCount">0</span>
                    </button>
                    <button id="addTaskBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                        ‚ûï Add Task
                    </button>
                    <button id="statsBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                        üìä Analytics
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <div class="flex space-x-2 bg-primary rounded-lg p-1">
            <div class="nav-tab active" data-view="dashboard">üìã Dashboard</div>
            <div class="nav-tab" data-view="calendar">üìÖ Calendar</div>
            <div class="nav-tab" data-view="analytics">üìà Analytics</div>
            <div class="nav-tab" data-view="settings">‚öôÔ∏è Settings</div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-8">
        <!-- Dashboard View -->
        <div id="dashboardView" class="view-content">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Task Management Section -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Quick Stats Widgets -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="widget text-center">
                            <div class="text-2xl font-bold text-blue-600" id="totalTasksWidget">0</div>
                            <div class="text-sm text-secondary">Total Tasks</div>
                        </div>
                        <div class="widget text-center">
                            <div class="text-2xl font-bold text-green-600" id="completedTasksWidget">0</div>
                            <div class="text-sm text-secondary">Completed</div>
                        </div>
                        <div class="widget text-center">
                            <div class="text-2xl font-bold text-red-600" id="overdueTasksWidget">0</div>
                            <div class="text-sm text-secondary">Overdue</div>
                        </div>
                        <div class="widget text-center">
                            <div class="text-2xl font-bold text-purple-600" id="productivityScore">0%</div>
                            <div class="text-sm text-secondary">Productivity</div>
                        </div>
                    </div>

                    <!-- Filters and Search -->
                    <div class="widget">
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="flex-1">
                                <input type="text" id="searchInput" placeholder="üîç Search tasks, subtasks, or notes..." 
                                       class="w-full px-4 py-2 border border-custom rounded-lg bg-primary text-primary">
                            </div>
                            <div class="flex gap-2">
                                <select id="categoryFilter" class="px-4 py-2 border border-custom rounded-lg bg-primary text-primary">
                                    <option value="">All Categories</option>
                                    <option value="work">üíº Work</option>
                                    <option value="personal">üë§ Personal</option>
                                    <option value="health">‚ù§Ô∏è Health</option>
                                    <option value="home">üè† Home</option>
                                    <option value="travel">‚úàÔ∏è Travel</option>
                                    <option value="learning">üìö Learning</option>
                                    <option value="finance">üí∞ Finance</option>
                                    <option value="shopping">üõí Shopping</option>
                                </select>
                                <select id="priorityFilter" class="px-4 py-2 border border-custom rounded-lg bg-primary text-primary">
                                    <option value="">All Priorities</option>
                                    <option value="urgent">üî¥ Urgent</option>
                                    <option value="high">üü† High</option>
                                    <option value="medium">üü° Medium</option>
                                    <option value="low">üü¢ Low</option>
                                </select>
                                <select id="statusFilter" class="px-4 py-2 border border-custom rounded-lg bg-primary text-primary">
                                    <option value="">All Status</option>
                                    <option value="pending">‚è≥ Pending</option>
                                    <option value="in-progress">üîÑ In Progress</option>
                                    <option value="completed">‚úÖ Completed</option>
                                    <option value="overdue">‚ö†Ô∏è Overdue</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Task List -->
                    <div class="widget">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-semibold text-primary">Your Tasks</h2>
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-secondary">Sort by:</span>
                                <select id="sortBy" class="bg-primary border border-custom rounded-md px-2 py-1 text-sm">
                                    <option value="date">Date Created</option>
                                    <option value="dueDate">Due Date</option>
                                    <option value="priority">Priority</option>
                                    <option value="category">Category</option>
                                    <option value="progress">Progress</option>
                                </select>
                            </div>
                        </div>
                        <div id="taskList" class="space-y-4">
                            <!-- Tasks will be dynamically added here -->
                        </div>
                        <div id="emptyState" class="text-center py-12 hidden">
                            <div class="text-6xl mb-4">üìù</div>
                            <h3 class="text-lg font-medium text-primary mb-2">No tasks yet</h3>
                            <p class="text-secondary">Add your first task to get started!</p>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="space-y-6">
                    <!-- Progress Overview -->
                    <div class="widget">
                        <h3 class="text-lg font-semibold text-primary mb-4">Today's Progress</h3>
                        <div class="flex items-center justify-center mb-4">
                            <div class="relative w-24 h-24">
                                <svg class="progress-ring w-24 h-24">
                                    <circle class="progress-ring-circle" stroke="var(--border)" stroke-width="4" fill="transparent" r="40" cx="48" cy="48"/>
                                    <circle id="progressCircle" class="progress-ring-circle" stroke="var(--accent)" stroke-width="4" fill="transparent" r="40" cx="48" cy="48" stroke-dasharray="251.2" stroke-dashoffset="251.2"/>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span id="progressText" class="text-lg font-bold text-primary">0%</span>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-secondary">Completed:</span>
                                <span id="completedCount" class="text-primary font-medium">0</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-secondary">In Progress:</span>
                                <span id="inProgressCount" class="text-primary font-medium">0</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-secondary">Remaining:</span>
                                <span id="remainingCount" class="text-primary font-medium">0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Add -->
                    <div class="widget">
                        <h3 class="text-lg font-semibold text-primary mb-4">Quick Add</h3>
                        <form id="quickAddForm" class="space-y-3">
                            <input type="text" id="quickTaskInput" placeholder="Enter task..." 
                                   class="w-full px-3 py-2 border border-custom rounded-lg bg-primary text-primary text-sm">
                            <div class="grid grid-cols-2 gap-2">
                                <select id="quickCategory" class="px-3 py-2 border border-custom rounded-lg bg-primary text-primary text-sm">
                                    <option value="personal">üë§ Personal</option>
                                    <option value="work">üíº Work</option>
                                    <option value="health">‚ù§Ô∏è Health</option>
                                    <option value="home">üè† Home</option>
                                    <option value="travel">‚úàÔ∏è Travel</option>
                                    <option value="learning">üìö Learning</option>
                                    <option value="finance">üí∞ Finance</option>
                                    <option value="shopping">üõí Shopping</option>
                                </select>
                                <select id="quickPriority" class="px-3 py-2 border border-custom rounded-lg bg-primary text-primary text-sm">
                                    <option value="medium">üü° Medium</option>
                                    <option value="urgent">üî¥ Urgent</option>
                                    <option value="high">üü† High</option>
                                    <option value="low">üü¢ Low</option>
                                </select>
                            </div>
                            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-medium transition-colors text-sm">
                                Add Task
                            </button>
                        </form>
                    </div>

                    <!-- Time Tracker Widget -->
                    <div class="widget">
                        <h3 class="text-lg font-semibold text-primary mb-4">Time Tracker</h3>
                        <div id="activeTimer" class="hidden">
                            <div class="text-center mb-4">
                                <div class="text-2xl font-mono font-bold text-blue-600" id="timerDisplay">00:00:00</div>
                                <div class="text-sm text-secondary" id="timerTaskName">Task Name</div>
                            </div>
                            <div class="flex gap-2">
                                <button id="pauseTimer" class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white py-2 rounded-lg text-sm">‚è∏Ô∏è Pause</button>
                                <button id="stopTimer" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg text-sm">‚èπÔ∏è Stop</button>
                            </div>
                        </div>
                        <div id="timerIdle" class="text-center">
                            <div class="text-4xl mb-2">‚è±Ô∏è</div>
                            <p class="text-sm text-secondary">No active timer</p>
                        </div>
                    </div>

                    <!-- Upcoming Reminders -->
                    <div class="widget">
                        <h3 class="text-lg font-semibold text-primary mb-4">Upcoming Reminders</h3>
                        <div id="remindersList" class="space-y-2">
                            <!-- Reminders will be added here -->
                        </div>
                        <div id="noReminders" class="text-center py-4">
                            <div class="text-2xl mb-2">üîî</div>
                            <p class="text-sm text-secondary">No upcoming reminders</p>
                        </div>
                    </div>

                    <!-- Mini Calendar -->
                    <div class="widget">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-primary">Calendar</h3>
                            <div class="flex items-center space-x-2">
                                <button id="prevMonth" class="text-secondary hover:text-primary">‚Äπ</button>
                                <span id="currentMonth" class="text-sm font-medium"></span>
                                <button id="nextMonth" class="text-secondary hover:text-primary">‚Ä∫</button>
                            </div>
                        </div>
                        <div id="miniCalendar" class="grid grid-cols-7 gap-1 text-sm">
                            <!-- Calendar will be generated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar View -->
        <div id="calendarView" class="view-content hidden">
            <div class="widget">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-primary">Calendar View</h2>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <button id="calPrevMonth" class="px-3 py-2 border border-custom rounded-lg hover:bg-gray-50">‚Äπ</button>
                            <span id="calCurrentMonth" class="text-lg font-semibold min-w-[200px] text-center"></span>
                            <button id="calNextMonth" class="px-3 py-2 border border-custom rounded-lg hover:bg-gray-50">‚Ä∫</button>
                        </div>
                        <button id="todayBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">Today</button>
                    </div>
                </div>
                <div class="calendar-grid" id="fullCalendar">
                    <!-- Full calendar will be generated here -->
                </div>
            </div>
        </div>

        <!-- Analytics View -->
        <div id="analyticsView" class="view-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="widget">
                    <h3 class="text-lg font-semibold text-primary mb-4">Task Distribution</h3>
                    <canvas id="categoryChart" width="400" height="300"></canvas>
                </div>
                <div class="widget">
                    <h3 class="text-lg font-semibold text-primary mb-4">Priority Analysis</h3>
                    <canvas id="priorityChart" width="400" height="300"></canvas>
                </div>
                <div class="widget">
                    <h3 class="text-lg font-semibold text-primary mb-4">Completion Trends</h3>
                    <canvas id="trendChart" width="400" height="300"></canvas>
                </div>
                <div class="widget">
                    <h3 class="text-lg font-semibold text-primary mb-4">Time Tracking</h3>
                    <canvas id="timeChart" width="400" height="300"></canvas>
                </div>
            </div>
        </div>

        <!-- Settings View -->
        <div id="settingsView" class="view-content hidden">
            <div class="max-w-2xl mx-auto space-y-6">
                <div class="widget">
                    <h3 class="text-lg font-semibold text-primary mb-4">Notification Settings</h3>
                    <div class="space-y-4">
                        <label class="flex items-center space-x-3">
                            <input type="checkbox" id="enableNotifications" class="rounded">
                            <span>Enable browser notifications</span>
                        </label>
                        <label class="flex items-center space-x-3">
                            <input type="checkbox" id="enableSounds" class="rounded">
                            <span>Enable notification sounds</span>
                        </label>
                        <div>
                            <label class="block text-sm font-medium mb-2">Default reminder time (minutes before due)</label>
                            <input type="number" id="defaultReminder" value="15" min="1" max="1440" 
                                   class="w-full px-3 py-2 border border-custom rounded-lg bg-primary text-primary">
                        </div>
                    </div>
                </div>
                
                <div class="widget">
                    <h3 class="text-lg font-semibold text-primary mb-4">Data Management</h3>
                    <div class="space-y-4">
                        <button id="exportData" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg">
                            üì§ Export All Data
                        </button>
                        <button id="importData" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg">
                            üì• Import Data
                        </button>
                        <input type="file" id="importFile" accept=".json" class="hidden">
                        <button id="clearData" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg">
                            üóëÔ∏è Clear All Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Add Task Modal -->
    <div id="addTaskModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden items-center justify-center z-50">
        <div class="bg-primary rounded-lg shadow-xl border border-custom p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-primary">Add New Task</h3>
                <button id="closeModal" class="text-secondary hover:text-primary text-2xl">&times;</button>
            </div>
            <form id="addTaskForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-primary mb-2">Task Title *</label>
                        <input type="text" id="taskTitle" required 
                               class="w-full px-4 py-2 border border-custom rounded-lg bg-primary text-primary">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-primary mb-2">Description</label>
                        <textarea id="taskDescription" rows="3" 
                                  class="w-full px-4 py-2 border border-custom rounded-lg bg-primary text-primary"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-primary mb-2">Category</label>
                        <select id="taskCategory" class="w-full px-4 py-2 border border-custom rounded-lg bg-primary text-primary">
                            <option value="personal">üë§ Personal</option>
                            <option value="work">üíº Work</option>
                            <option value="health">‚ù§Ô∏è Health</option>
                            <option value="home">üè† Home</option>
                            <option value="travel">‚úàÔ∏è Travel</option>
                            <option value="learning">üìö Learning</option>
                            <option value="finance">üí∞ Finance</option>
                            <option value="shopping">üõí Shopping</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-primary mb-2">Priority</label>
                        <select id="taskPriority" class="w-full px-4 py-2 border border-custom rounded-lg bg-primary text-primary">
                            <option value="low">üü¢ Low</option>
                            <option value="medium">üü° Medium</option>
                            <option value="high">üü† High</option>
                            <option value="urgent">üî¥ Urgent</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-primary mb-2">Due Date</label>
                        <input type="date" id="taskDueDate" 
                               class="w-full px-4 py-2 border border-custom rounded-lg bg-primary text-primary">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-primary mb-2">Due Time</label>
                        <input type="time" id="taskDueTime" 
                               class="w-full px-4 py-2 border border-custom rounded-lg bg-primary text-primary">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-primary mb-2">Estimated Hours</label>
                        <input type="number" id="taskEstimatedHours" min="0" step="0.5" 
                               class="w-full px-4 py-2 border border-custom rounded-lg bg-primary text-primary">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-primary mb-2">Reminder (minutes before)</label>
                        <input type="number" id="taskReminder" value="15" min="1" max="1440" 
                               class="w-full px-4 py-2 border border-custom rounded-lg bg-primary text-primary">
                    </div>
                </div>
                
                <!-- Subtasks Section -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-sm font-medium text-primary">Subtasks</label>
                        <button type="button" id="addSubtask" class="text-blue-600 hover:text-blue-800 text-sm">+ Add Subtask</button>
                    </div>
                    <div id="subtasksList" class="space-y-2">
                        <!-- Subtasks will be added here -->
                    </div>
                </div>

                <!-- Checklist Section -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-sm font-medium text-primary">Checklist Items</label>
                        <button type="button" id="addChecklistItem" class="text-blue-600 hover:text-blue-800 text-sm">+ Add Item</button>
                    </div>
                    <div id="checklistItems" class="space-y-2">
                        <!-- Checklist items will be added here -->
                    </div>
                </div>

                <div class="flex gap-3 pt-4">
                    <button type="button" id="cancelTask" 
                            class="flex-1 px-4 py-2 border border-custom rounded-lg text-secondary hover:bg-gray-50 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" 
                            class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                        Add Task
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Task Detail Modal -->
    <div id="taskDetailModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden items-center justify-center z-50">
        <div class="bg-primary rounded-lg shadow-xl border border-custom p-6 w-full max-w-3xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-primary" id="taskDetailTitle">Task Details</h3>
                <button id="closeTaskDetail" class="text-secondary hover:text-primary text-2xl">&times;</button>
            </div>
            <div id="taskDetailContent">
                <!-- Task details will be populated here -->
            </div>
        </div>
    </div>

    <!-- Reminder Modal -->
    <div id="reminderModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden items-center justify-center z-50">
        <div class="bg-primary rounded-lg shadow-xl border border-custom p-6 w-full max-w-md mx-4">
            <div class="text-center">
                <div class="text-4xl mb-4">üîî</div>
                <h3 class="text-lg font-semibold text-primary mb-2">Task Reminder</h3>
                <p id="reminderText" class="text-secondary mb-4"></p>
                <div class="flex gap-3">
                    <button id="snoozeReminder" class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white py-2 rounded-lg">
                        Snooze 5min
                    </button>
                    <button id="dismissReminder" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg">
                        Dismiss
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div id="notifications" class="fixed top-4 right-4 space-y-2 z-50"></div>

    <script>
        class AdvancedTaskManager {
            constructor() {
                this.tasks = JSON.parse(localStorage.getItem('tasks')) || [];
                this.settings = JSON.parse(localStorage.getItem('settings')) || {
                    enableNotifications: true,
                    enableSounds: true,
                    defaultReminder: 15
                };
                this.currentTheme = localStorage.getItem('theme') || 'light';
                this.currentView = 'dashboard';
                this.currentDate = new Date();
                this.calendarDate = new Date();
                this.activeTimer = null;
                this.timerInterval = null;
                this.reminderInterval = null;
                this.charts = {};
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.applyTheme(this.currentTheme);
                this.renderTasks();
                this.updateProgress();
                this.generateCalendar();
                this.generateFullCalendar();
                this.updateStats();
                this.startReminderCheck();
                this.requestNotificationPermission();
                this.loadSettings();
                
                // Add sample data if none exists
                if (this.tasks.length === 0) {
                    this.addSampleTasks();
                }
            }

            setupEventListeners() {
                // Theme selector
                document.getElementById('themeSelector').addEventListener('change', (e) => {
                    this.applyTheme(e.target.value);
                });

                // Navigation tabs
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        this.switchView(e.target.dataset.view);
                    });
                });

                // Modal controls
                document.getElementById('addTaskBtn').addEventListener('click', () => {
                    this.showModal('addTaskModal');
                });

                document.getElementById('statsBtn').addEventListener('click', () => {
                    this.switchView('analytics');
                });

                document.getElementById('reminderBtn').addEventListener('click', () => {
                    this.showReminders();
                });

                // Close modal buttons
                document.getElementById('closeModal').addEventListener('click', () => {
                    this.hideModal('addTaskModal');
                });

                document.getElementById('closeTaskDetail').addEventListener('click', () => {
                    this.hideModal('taskDetailModal');
                });

                document.getElementById('cancelTask').addEventListener('click', () => {
                    this.hideModal('addTaskModal');
                });

                // Form submissions
                document.getElementById('addTaskForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addTask();
                });

                document.getElementById('quickAddForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.quickAddTask();
                });

                // Filters and search
                document.getElementById('searchInput').addEventListener('input', () => {
                    this.renderTasks();
                });

                ['categoryFilter', 'priorityFilter', 'statusFilter', 'sortBy'].forEach(id => {
                    document.getElementById(id).addEventListener('change', () => {
                        this.renderTasks();
                    });
                });

                // Subtask and checklist management
                document.getElementById('addSubtask').addEventListener('click', () => {
                    this.addSubtaskInput();
                });

                document.getElementById('addChecklistItem').addEventListener('click', () => {
                    this.addChecklistInput();
                });

                // Calendar navigation
                document.getElementById('prevMonth').addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                    this.generateCalendar();
                });

                document.getElementById('nextMonth').addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                    this.generateCalendar();
                });

                document.getElementById('calPrevMonth').addEventListener('click', () => {
                    this.calendarDate.setMonth(this.calendarDate.getMonth() - 1);
                    this.generateFullCalendar();
                });

                document.getElementById('calNextMonth').addEventListener('click', () => {
                    this.calendarDate.setMonth(this.calendarDate.getMonth() + 1);
                    this.generateFullCalendar();
                });

                document.getElementById('todayBtn').addEventListener('click', () => {
                    this.calendarDate = new Date();
                    this.generateFullCalendar();
                });

                // Timer controls
                document.getElementById('pauseTimer').addEventListener('click', () => {
                    this.pauseTimer();
                });

                document.getElementById('stopTimer').addEventListener('click', () => {
                    this.stopTimer();
                });

                // Reminder controls
                document.getElementById('snoozeReminder').addEventListener('click', () => {
                    this.snoozeReminder();
                });

                document.getElementById('dismissReminder').addEventListener('click', () => {
                    this.dismissReminder();
                });

                // Settings
                document.getElementById('enableNotifications').addEventListener('change', (e) => {
                    this.settings.enableNotifications = e.target.checked;
                    this.saveSettings();
                });

                document.getElementById('enableSounds').addEventListener('change', (e) => {
                    this.settings.enableSounds = e.target.checked;
                    this.saveSettings();
                });

                document.getElementById('defaultReminder').addEventListener('change', (e) => {
                    this.settings.defaultReminder = parseInt(e.target.value);
                    this.saveSettings();
                });

                // Data management
                document.getElementById('exportData').addEventListener('click', () => {
                    this.exportData();
                });

                document.getElementById('importData').addEventListener('click', () => {
                    document.getElementById('importFile').click();
                });

                document.getElementById('importFile').addEventListener('change', (e) => {
                    this.importData(e.target.files[0]);
                });

                document.getElementById('clearData').addEventListener('click', () => {
                    this.clearAllData();
                });

                // Close modals on outside click
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('modal')) {
                        this.hideModal(e.target.id);
                    }
                });
            }

            switchView(view) {
                // Update navigation
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-view="${view}"]`).classList.add('active');

                // Show/hide views
                document.querySelectorAll('.view-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(`${view}View`).classList.remove('hidden');

                this.currentView = view;

                // Load view-specific content
                if (view === 'analytics') {
                    setTimeout(() => this.renderCharts(), 100);
                } else if (view === 'calendar') {
                    this.generateFullCalendar();
                }
            }

            applyTheme(theme) {
                this.currentTheme = theme;
                document.body.setAttribute('data-theme', theme);
                document.getElementById('themeSelector').value = theme;
                localStorage.setItem('theme', theme);
            }

            showModal(modalId) {
                const modal = document.getElementById(modalId);
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }

            hideModal(modalId) {
                const modal = document.getElementById(modalId);
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                
                if (modalId === 'addTaskModal') {
                    document.getElementById('addTaskForm').reset();
                    document.getElementById('subtasksList').innerHTML = '';
                    document.getElementById('checklistItems').innerHTML = '';
                }
            }

            addSubtaskInput() {
                const container = document.getElementById('subtasksList');
                const div = document.createElement('div');
                div.className = 'flex items-center space-x-2';
                div.innerHTML = `
                    <input type="text" placeholder="Subtask title..." 
                           class="flex-1 px-3 py-2 border border-custom rounded-lg bg-primary text-primary text-sm subtask-input">
                    <button type="button" onclick="this.parentElement.remove()" 
                            class="text-red-600 hover:text-red-800">√ó</button>
                `;
                container.appendChild(div);
            }

            addChecklistInput() {
                const container = document.getElementById('checklistItems');
                const div = document.createElement('div');
                div.className = 'flex items-center space-x-2';
                div.innerHTML = `
                    <input type="text" placeholder="Checklist item..." 
                           class="flex-1 px-3 py-2 border border-custom rounded-lg bg-primary text-primary text-sm checklist-input">
                    <button type="button" onclick="this.parentElement.remove()" 
                            class="text-red-600 hover:text-red-800">√ó</button>
                `;
                container.appendChild(div);
            }

            addTask() {
                const title = document.getElementById('taskTitle').value;
                const description = document.getElementById('taskDescription').value;
                const category = document.getElementById('taskCategory').value;
                const priority = document.getElementById('taskPriority').value;
                const dueDate = document.getElementById('taskDueDate').value;
                const dueTime = document.getElementById('taskDueTime').value;
                const estimatedHours = parseFloat(document.getElementById('taskEstimatedHours').value) || 0;
                const reminderMinutes = parseInt(document.getElementById('taskReminder').value) || 15;

                // Collect subtasks
                const subtasks = Array.from(document.querySelectorAll('.subtask-input'))
                    .map(input => input.value.trim())
                    .filter(value => value)
                    .map(title => ({
                        id: Date.now() + Math.random(),
                        title,
                        completed: false
                    }));

                // Collect checklist items
                const checklist = Array.from(document.querySelectorAll('.checklist-input'))
                    .map(input => input.value.trim())
                    .filter(value => value)
                    .map(title => ({
                        id: Date.now() + Math.random(),
                        title,
                        completed: false
                    }));

                const task = {
                    id: Date.now(),
                    title,
                    description,
                    category,
                    priority,
                    dueDate,
                    dueTime,
                    estimatedHours,
                    reminderMinutes,
                    subtasks,
                    checklist,
                    status: 'pending',
                    progress: 0,
                    timeSpent: 0,
                    completed: false,
                    createdAt: new Date().toISOString(),
                    notes: []
                };

                this.tasks.push(task);
                this.saveTasks();
                this.renderTasks();
                this.updateProgress();
                this.updateStats();
                this.generateCalendar();
                this.generateFullCalendar();
                this.hideModal('addTaskModal');
                this.showNotification('Task added successfully!', 'success');
            }

            quickAddTask() {
                const title = document.getElementById('quickTaskInput').value;
                const category = document.getElementById('quickCategory').value;
                const priority = document.getElementById('quickPriority').value;

                if (!title.trim()) return;

                const task = {
                    id: Date.now(),
                    title,
                    description: '',
                    category,
                    priority,
                    dueDate: '',
                    dueTime: '',
                    estimatedHours: 0,
                    reminderMinutes: this.settings.defaultReminder,
                    subtasks: [],
                    checklist: [],
                    status: 'pending',
                    progress: 0,
                    timeSpent: 0,
                    completed: false,
                    createdAt: new Date().toISOString(),
                    notes: []
                };

                this.tasks.push(task);
                this.saveTasks();
                this.renderTasks();
                this.updateProgress();
                this.updateStats();
                document.getElementById('quickAddForm').reset();
                this.showNotification('Task added quickly!', 'success');
            }

            toggleTask(id) {
                const task = this.tasks.find(t => t.id === id);
                if (task) {
                    task.completed = !task.completed;
                    task.status = task.completed ? 'completed' : 'pending';
                    task.progress = task.completed ? 100 : this.calculateProgress(task);
                    
                    if (task.completed) {
                        task.completedAt = new Date().toISOString();
                    }
                    
                    this.saveTasks();
                    this.renderTasks();
                    this.updateProgress();
                    this.updateStats();
                    this.showNotification(
                        task.completed ? 'Task completed! üéâ' : 'Task marked as incomplete',
                        task.completed ? 'success' : 'info'
                    );
                }
            }

            toggleSubtask(taskId, subtaskId) {
                const task = this.tasks.find(t => t.id === taskId);
                if (task) {
                    const subtask = task.subtasks.find(s => s.id === subtaskId);
                    if (subtask) {
                        subtask.completed = !subtask.completed;
                        task.progress = this.calculateProgress(task);
                        this.saveTasks();
                        this.renderTasks();
                        this.updateProgress();
                    }
                }
            }

            toggleChecklistItem(taskId, itemId) {
                const task = this.tasks.find(t => t.id === taskId);
                if (task) {
                    const item = task.checklist.find(i => i.id === itemId);
                    if (item) {
                        item.completed = !item.completed;
                        task.progress = this.calculateProgress(task);
                        this.saveTasks();
                        this.renderTasks();
                        this.updateProgress();
                    }
                }
            }

            calculateProgress(task) {
                if (task.completed) return 100;
                
                let totalItems = 1; // The main task
                let completedItems = 0;
                
                // Add subtasks
                if (task.subtasks.length > 0) {
                    totalItems += task.subtasks.length;
                    completedItems += task.subtasks.filter(s => s.completed).length;
                }
                
                // Add checklist items
                if (task.checklist.length > 0) {
                    totalItems += task.checklist.length;
                    completedItems += task.checklist.filter(i => i.completed).length;
                }
                
                return Math.round((completedItems / totalItems) * 100);
            }

            updateTaskStatus(id, status) {
                const task = this.tasks.find(t => t.id === id);
                if (task) {
                    task.status = status;
                    if (status === 'completed') {
                        task.completed = true;
                        task.progress = 100;
                        task.completedAt = new Date().toISOString();
                    } else if (status === 'in-progress') {
                        task.completed = false;
                    }
                    this.saveTasks();
                    this.renderTasks();
                    this.updateProgress();
                    this.updateStats();
                }
            }

            startTimer(taskId) {
                const task = this.tasks.find(t => t.id === taskId);
                if (!task) return;

                this.activeTimer = {
                    taskId,
                    startTime: Date.now(),
                    pausedTime: 0
                };

                document.getElementById('timerTaskName').textContent = task.title;
                document.getElementById('activeTimer').classList.remove('hidden');
                document.getElementById('timerIdle').classList.add('hidden');

                this.timerInterval = setInterval(() => {
                    this.updateTimerDisplay();
                }, 1000);

                this.showNotification(`Timer started for: ${task.title}`, 'info');
            }

            pauseTimer() {
                if (this.activeTimer && this.timerInterval) {
                    this.activeTimer.pausedTime += Date.now() - this.activeTimer.startTime;
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                    this.showNotification('Timer paused', 'info');
                }
            }

            stopTimer() {
                if (this.activeTimer) {
                    const totalTime = this.activeTimer.pausedTime + (Date.now() - this.activeTimer.startTime);
                    const hours = totalTime / (1000 * 60 * 60);
                    
                    const task = this.tasks.find(t => t.id === this.activeTimer.taskId);
                    if (task) {
                        task.timeSpent += hours;
                        this.saveTasks();
                    }

                    clearInterval(this.timerInterval);
                    this.activeTimer = null;
                    this.timerInterval = null;

                    document.getElementById('activeTimer').classList.add('hidden');
                    document.getElementById('timerIdle').classList.remove('hidden');
                    document.getElementById('timerDisplay').textContent = '00:00:00';

                    this.showNotification(`Timer stopped. Time logged: ${this.formatTime(totalTime)}`, 'success');
                    this.updateStats();
                }
            }

            updateTimerDisplay() {
                if (this.activeTimer) {
                    const elapsed = this.activeTimer.pausedTime + (Date.now() - this.activeTimer.startTime);
                    document.getElementById('timerDisplay').textContent = this.formatTime(elapsed);
                }
            }

            formatTime(milliseconds) {
                const seconds = Math.floor(milliseconds / 1000);
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }

            deleteTask(id) {
                if (confirm('Are you sure you want to delete this task? This action cannot be undone.')) {
                    this.tasks = this.tasks.filter(t => t.id !== id);
                    this.saveTasks();
                    this.renderTasks();
                    this.updateProgress();
                    this.updateStats();
                    this.generateCalendar();
                    this.generateFullCalendar();
                    this.showNotification('Task deleted', 'error');
                }
            }

            duplicateTask(id) {
                const task = this.tasks.find(t => t.id === id);
                if (task) {
                    const newTask = {
                        ...task,
                        id: Date.now(),
                        title: `${task.title} (Copy)`,
                        completed: false,
                        status: 'pending',
                        progress: 0,
                        timeSpent: 0,
                        createdAt: new Date().toISOString(),
                        completedAt: null,
                        subtasks: task.subtasks.map(s => ({ ...s, completed: false })),
                        checklist: task.checklist.map(c => ({ ...c, completed: false }))
                    };
                    this.tasks.push(newTask);
                    this.saveTasks();
                    this.renderTasks();
                    this.updateStats();
                    this.showNotification('Task duplicated successfully!', 'success');
                }
            }

            showTaskDetail(id) {
                const task = this.tasks.find(t => t.id === id);
                if (!task) return;

                const modal = document.getElementById('taskDetailModal');
                const content = document.getElementById('taskDetailContent');
                
                const categoryIcons = {
                    work: 'üíº', personal: 'üë§', health: '‚ù§Ô∏è', home: 'üè†',
                    travel: '‚úàÔ∏è', learning: 'üìö', finance: 'üí∞', shopping: 'üõí'
                };

                const priorityColors = {
                    urgent: 'text-red-600', high: 'text-orange-600',
                    medium: 'text-yellow-600', low: 'text-green-600'
                };

                const statusColors = {
                    pending: 'bg-gray-100 text-gray-800',
                    'in-progress': 'bg-blue-100 text-blue-800',
                    completed: 'bg-green-100 text-green-800',
                    overdue: 'bg-red-100 text-red-800'
                };

                content.innerHTML = `
                    <div class="space-y-6">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h2 class="text-2xl font-bold text-primary mb-2">${task.title}</h2>
                                <div class="flex items-center space-x-4 text-sm">
                                    <span class="flex items-center space-x-1">
                                        <span>${categoryIcons[task.category]}</span>
                                        <span class="capitalize">${task.category}</span>
                                    </span>
                                    <span class="capitalize ${priorityColors[task.priority]}">${task.priority} Priority</span>
                                    <span class="px-2 py-1 rounded-full text-xs ${statusColors[task.status]}">${task.status.replace('-', ' ')}</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-blue-600">${task.progress}%</div>
                                <div class="text-sm text-secondary">Complete</div>
                            </div>
                        </div>

                        ${task.description ? `
                            <div>
                                <h3 class="font-semibold text-primary mb-2">Description</h3>
                                <p class="text-secondary">${task.description}</p>
                            </div>
                        ` : ''}

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <h3 class="font-semibold text-primary mb-2">Task Info</h3>
                                <div class="space-y-2 text-sm">
                                    ${task.dueDate ? `<div><strong>Due:</strong> ${new Date(task.dueDate + (task.dueTime ? 'T' + task.dueTime : '')).toLocaleString()}</div>` : ''}
                                    ${task.estimatedHours ? `<div><strong>Estimated:</strong> ${task.estimatedHours} hours</div>` : ''}
                                    <div><strong>Time Spent:</strong> ${task.timeSpent.toFixed(1)} hours</div>
                                    <div><strong>Created:</strong> ${new Date(task.createdAt).toLocaleDateString()}</div>
                                    ${task.completedAt ? `<div><strong>Completed:</strong> ${new Date(task.completedAt).toLocaleDateString()}</div>` : ''}
                                </div>
                            </div>
                            <div>
                                <h3 class="font-semibold text-primary mb-2">Actions</h3>
                                <div class="space-y-2">
                                    <button onclick="taskManager.startTimer(${task.id})" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg text-sm">
                                        ‚è±Ô∏è Start Timer
                                    </button>
                                    <select onchange="taskManager.updateTaskStatus(${task.id}, this.value)" class="w-full px-3 py-2 border border-custom rounded-lg bg-primary text-primary text-sm">
                                        <option value="pending" ${task.status === 'pending' ? 'selected' : ''}>‚è≥ Pending</option>
                                        <option value="in-progress" ${task.status === 'in-progress' ? 'selected' : ''}>üîÑ In Progress</option>
                                        <option value="completed" ${task.status === 'completed' ? 'selected' : ''}>‚úÖ Completed</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        ${task.subtasks.length > 0 ? `
                            <div>
                                <h3 class="font-semibold text-primary mb-2">Subtasks (${task.subtasks.filter(s => s.completed).length}/${task.subtasks.length})</h3>
                                <div class="space-y-2">
                                    ${task.subtasks.map(subtask => `
                                        <div class="subtask-item flex items-center space-x-3">
                                            <button onclick="taskManager.toggleSubtask(${task.id}, ${subtask.id})" 
                                                    class="w-4 h-4 rounded border-2 border-gray-300 flex items-center justify-center hover:border-blue-500 transition-colors ${subtask.completed ? 'bg-blue-500 border-blue-500' : ''}">
                                                ${subtask.completed ? '<span class="text-white text-xs">‚úì</span>' : ''}
                                            </button>
                                            <span class="${subtask.completed ? 'line-through text-secondary' : 'text-primary'}">${subtask.title}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}

                        ${task.checklist.length > 0 ? `
                            <div>
                                <h3 class="font-semibold text-primary mb-2">Checklist (${task.checklist.filter(c => c.completed).length}/${task.checklist.length})</h3>
                                <div class="space-y-2">
                                    ${task.checklist.map(item => `
                                        <div class="checklist-item">
                                            <button onclick="taskManager.toggleChecklistItem(${task.id}, ${item.id})" 
                                                    class="w-4 h-4 rounded border-2 border-gray-300 flex items-center justify-center hover:border-blue-500 transition-colors ${item.completed ? 'bg-blue-500 border-blue-500' : ''}">
                                                ${item.completed ? '<span class="text-white text-xs">‚úì</span>' : ''}
                                            </button>
                                            <span class="${item.completed ? 'line-through text-secondary' : 'text-primary'}">${item.title}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}

                        <div class="flex gap-3 pt-4 border-t border-custom">
                            <button onclick="taskManager.duplicateTask(${task.id}); taskManager.hideModal('taskDetailModal')" 
                                    class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg">
                                üìã Duplicate
                            </button>
                            <button onclick="taskManager.deleteTask(${task.id}); taskManager.hideModal('taskDetailModal')" 
                                    class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    </div>
                `;

                this.showModal('taskDetailModal');
            }

            getFilteredTasks() {
                let filtered = [...this.tasks];

                // Search filter
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                if (searchTerm) {
                    filtered = filtered.filter(task => 
                        task.title.toLowerCase().includes(searchTerm) ||
                        task.description.toLowerCase().includes(searchTerm) ||
                        task.subtasks.some(s => s.title.toLowerCase().includes(searchTerm)) ||
                        task.checklist.some(c => c.title.toLowerCase().includes(searchTerm))
                    );
                }

                // Category filter
                const categoryFilter = document.getElementById('categoryFilter').value;
                if (categoryFilter) {
                    filtered = filtered.filter(task => task.category === categoryFilter);
                }

                // Priority filter
                const priorityFilter = document.getElementById('priorityFilter').value;
                if (priorityFilter) {
                    filtered = filtered.filter(task => task.priority === priorityFilter);
                }

                // Status filter
                const statusFilter = document.getElementById('statusFilter').value;
                if (statusFilter) {
                    if (statusFilter === 'overdue') {
                        filtered = filtered.filter(task => 
                            task.dueDate && new Date(task.dueDate) < new Date() && !task.completed
                        );
                    } else {
                        filtered = filtered.filter(task => task.status === statusFilter);
                    }
                }

                // Sort
                const sortBy = document.getElementById('sortBy').value;
                filtered.sort((a, b) => {
                    switch (sortBy) {
                        case 'priority':
                            const priorityOrder = { urgent: 4, high: 3, medium: 2, low: 1 };
                            return priorityOrder[b.priority] - priorityOrder[a.priority];
                        case 'category':
                            return a.category.localeCompare(b.category);
                        case 'dueDate':
                            if (!a.dueDate && !b.dueDate) return 0;
                            if (!a.dueDate) return 1;
                            if (!b.dueDate) return -1;
                            return new Date(a.dueDate) - new Date(b.dueDate);
                        case 'progress':
                            return b.progress - a.progress;
                        case 'date':
                        default:
                            return new Date(b.createdAt) - new Date(a.createdAt);
                    }
                });

                return filtered;
            }

            renderTasks() {
                const taskList = document.getElementById('taskList');
                const emptyState = document.getElementById('emptyState');
                const filteredTasks = this.getFilteredTasks();

                if (filteredTasks.length === 0) {
                    taskList.innerHTML = '';
                    emptyState.classList.remove('hidden');
                    return;
                }

                emptyState.classList.add('hidden');

                const categoryIcons = {
                    work: 'üíº', personal: 'üë§', health: '‚ù§Ô∏è', home: 'üè†',
                    travel: '‚úàÔ∏è', learning: 'üìö', finance: 'üí∞', shopping: 'üõí'
                };

                const priorityColors = {
                    urgent: 'priority-high border-red-500',
                    high: 'priority-high border-orange-500',
                    medium: 'priority-medium border-yellow-500',
                    low: 'priority-low border-green-500'
                };

                const statusColors = {
                    pending: 'bg-gray-100 text-gray-800',
                    'in-progress': 'bg-blue-100 text-blue-800',
                    completed: 'bg-green-100 text-green-800'
                };

                taskList.innerHTML = filteredTasks.map(task => {
                    const isOverdue = task.dueDate && new Date(task.dueDate) < new Date() && !task.completed;
                    const hasSubtasks = task.subtasks.length > 0;
                    const hasChecklist = task.checklist.length > 0;
                    const completedSubtasks = task.subtasks.filter(s => s.completed).length;
                    const completedChecklist = task.checklist.filter(c => c.completed).length;

                    return `
                        <div class="task-item border border-custom rounded-lg p-4 ${task.completed ? 'completed-task' : ''} ${priorityColors[task.priority]} slide-in ${isOverdue ? 'reminder-active' : ''}">
                            <div class="flex items-start justify-between mb-3">
                                <div class="flex items-start space-x-3 flex-1">
                                    <button onclick="taskManager.toggleTask(${task.id})" 
                                            class="mt-1 w-5 h-5 rounded border-2 border-gray-300 flex items-center justify-center hover:border-blue-500 transition-colors ${task.completed ? 'bg-blue-500 border-blue-500' : ''}">
                                        ${task.completed ? '<span class="text-white text-xs">‚úì</span>' : ''}
                                    </button>
                                    <div class="flex-1">
                                        <div class="flex items-center space-x-2 mb-1">
                                            <span class="text-lg">${categoryIcons[task.category]}</span>
                                            <h3 class="font-medium text-primary ${task.completed ? 'line-through' : ''} cursor-pointer hover:text-blue-600" 
                                                onclick="taskManager.showTaskDetail(${task.id})">${task.title}</h3>
                                            <span class="px-2 py-1 rounded-full text-xs ${statusColors[task.status]}">${task.status.replace('-', ' ')}</span>
                                            ${isOverdue ? '<span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full pulse">Overdue</span>' : ''}
                                        </div>
                                        ${task.description ? `<p class="text-sm text-secondary mb-2">${task.description}</p>` : ''}
                                        
                                        <!-- Progress Bar -->
                                        <div class="mb-2">
                                            <div class="flex justify-between text-xs text-secondary mb-1">
                                                <span>Progress</span>
                                                <span>${task.progress}%</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: ${task.progress}%"></div>
                                            </div>
                                        </div>

                                        <!-- Subtasks Preview -->
                                        ${hasSubtasks ? `
                                            <div class="mb-2">
                                                <div class="text-xs text-secondary mb-1">Subtasks: ${completedSubtasks}/${task.subtasks.length}</div>
                                                <div class="space-y-1">
                                                    ${task.subtasks.slice(0, 2).map(subtask => `
                                                        <div class="flex items-center space-x-2 text-sm">
                                                            <button onclick="taskManager.toggleSubtask(${task.id}, ${subtask.id})" 
                                                                    class="w-3 h-3 rounded border border-gray-300 flex items-center justify-center hover:border-blue-500 transition-colors ${subtask.completed ? 'bg-blue-500 border-blue-500' : ''}">
                                                                ${subtask.completed ? '<span class="text-white text-xs">‚úì</span>' : ''}
                                                            </button>
                                                            <span class="${subtask.completed ? 'line-through text-secondary' : 'text-primary'}">${subtask.title}</span>
                                                        </div>
                                                    `).join('')}
                                                    ${task.subtasks.length > 2 ? `<div class="text-xs text-secondary">+${task.subtasks.length - 2} more...</div>` : ''}
                                                </div>
                                            </div>
                                        ` : ''}

                                        <!-- Checklist Preview -->
                                        ${hasChecklist ? `
                                            <div class="mb-2">
                                                <div class="text-xs text-secondary mb-1">Checklist: ${completedChecklist}/${task.checklist.length}</div>
                                                <div class="space-y-1">
                                                    ${task.checklist.slice(0, 2).map(item => `
                                                        <div class="flex items-center space-x-2 text-sm">
                                                            <button onclick="taskManager.toggleChecklistItem(${task.id}, ${item.id})" 
                                                                    class="w-3 h-3 rounded border border-gray-300 flex items-center justify-center hover:border-blue-500 transition-colors ${item.completed ? 'bg-blue-500 border-blue-500' : ''}">
                                                                ${item.completed ? '<span class="text-white text-xs">‚úì</span>' : ''}
                                                            </button>
                                                            <span class="${item.completed ? 'line-through text-secondary' : 'text-primary'}">${item.title}</span>
                                                        </div>
                                                    `).join('')}
                                                    ${task.checklist.length > 2 ? `<div class="text-xs text-secondary">+${task.checklist.length - 2} more...</div>` : ''}
                                                </div>
                                            </div>
                                        ` : ''}

                                        <div class="flex items-center space-x-4 text-xs text-secondary">
                                            <span class="capitalize">${task.priority} priority</span>
                                            ${task.dueDate ? `<span>Due: ${new Date(task.dueDate + (task.dueTime ? 'T' + task.dueTime : '')).toLocaleDateString()}</span>` : ''}
                                            ${task.timeSpent > 0 ? `<span>Time: ${task.timeSpent.toFixed(1)}h</span>` : ''}
                                            ${task.estimatedHours > 0 ? `<span>Est: ${task.estimatedHours}h</span>` : ''}
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2 ml-4">
                                    <button onclick="taskManager.startTimer(${task.id})" 
                                            class="text-blue-600 hover:text-blue-800 text-sm" title="Start Timer">‚è±Ô∏è</button>
                                    <button onclick="taskManager.showTaskDetail(${task.id})" 
                                            class="text-green-600 hover:text-green-800 text-sm" title="View Details">üëÅÔ∏è</button>
                                    <button onclick="taskManager.duplicateTask(${task.id})" 
                                            class="text-purple-600 hover:text-purple-800 text-sm" title="Duplicate">üìã</button>
                                    <button onclick="taskManager.deleteTask(${task.id})" 
                                            class="text-red-600 hover:text-red-800 text-sm" title="Delete">üóëÔ∏è</button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            updateProgress() {
                const totalTasks = this.tasks.length;
                const completedTasks = this.tasks.filter(t => t.completed).length;
                const inProgressTasks = this.tasks.filter(t => t.status === 'in-progress').length;
                const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

                document.getElementById('progressText').textContent = `${percentage}%`;
                document.getElementById('completedCount').textContent = completedTasks;
                document.getElementById('inProgressCount').textContent = inProgressTasks;
                document.getElementById('remainingCount').textContent = totalTasks - completedTasks;

                // Update progress ring
                const circle = document.getElementById('progressCircle');
                const circumference = 2 * Math.PI * 40;
                const offset = circumference - (percentage / 100) * circumference;
                circle.style.strokeDashoffset = offset;
            }

            updateStats() {
                const totalTasks = this.tasks.length;
                const completedTasks = this.tasks.filter(t => t.completed).length;
                const overdueTasks = this.tasks.filter(t => 
                    t.dueDate && new Date(t.dueDate) < new Date() && !t.completed
                ).length;
                
                // Calculate productivity score
                const thisWeek = new Date();
                thisWeek.setDate(thisWeek.getDate() - 7);
                const weeklyTasks = this.tasks.filter(t => new Date(t.createdAt) >= thisWeek);
                const weeklyCompleted = weeklyTasks.filter(t => t.completed).length;
                const productivityScore = weeklyTasks.length > 0 ? Math.round((weeklyCompleted / weeklyTasks.length) * 100) : 0;

                document.getElementById('totalTasksWidget').textContent = totalTasks;
                document.getElementById('completedTasksWidget').textContent = completedTasks;
                document.getElementById('overdueTasksWidget').textContent = overdueTasks;
                document.getElementById('productivityScore').textContent = `${productivityScore}%`;

                // Update reminder count
                const upcomingReminders = this.getUpcomingReminders();
                document.getElementById('reminderCount').textContent = upcomingReminders.length;
                
                if (upcomingReminders.length > 0) {
                    document.getElementById('reminderBtn').classList.add('pulse');
                } else {
                    document.getElementById('reminderBtn').classList.remove('pulse');
                }
            }

            generateCalendar() {
                const calendar = document.getElementById('miniCalendar');
                const currentMonth = document.getElementById('currentMonth');
                
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();
                
                currentMonth.textContent = this.currentDate.toLocaleDateString('en-US', { 
                    month: 'long', 
                    year: 'numeric' 
                });

                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const today = new Date();

                const dayNames = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
                let calendarHTML = dayNames.map(day => 
                    `<div class="text-center font-medium text-secondary p-1">${day}</div>`
                ).join('');

                // Empty cells for days before month starts
                for (let i = 0; i < firstDay; i++) {
                    calendarHTML += '<div class="p-1"></div>';
                }

                // Days of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(year, month, day);
                    const dateString = date.toISOString().split('T')[0];
                    const hasTasks = this.tasks.some(task => task.dueDate === dateString);
                    const isToday = day === today.getDate() && month === today.getMonth() && year === today.getFullYear();

                    calendarHTML += `
                        <div class="calendar-day p-1 text-center cursor-pointer rounded text-sm ${isToday ? 'selected' : ''} ${hasTasks ? 'has-tasks' : ''}"
                             onclick="taskManager.selectDate('${dateString}')">
                            ${day}
                        </div>
                    `;
                }

                calendar.innerHTML = calendarHTML;
            }

            generateFullCalendar() {
                const calendar = document.getElementById('fullCalendar');
                const currentMonth = document.getElementById('calCurrentMonth');
                
                const year = this.calendarDate.getFullYear();
                const month = this.calendarDate.getMonth();
                
                currentMonth.textContent = this.calendarDate.toLocaleDateString('en-US', { 
                    month: 'long', 
                    year: 'numeric' 
                });

                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const today = new Date();

                // Header row
                const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                let calendarHTML = dayNames.map(day => 
                    `<div class="calendar-cell font-semibold text-center text-secondary bg-gray-50 p-2">${day}</div>`
                ).join('');

                // Empty cells for days before month starts
                const prevMonth = new Date(year, month - 1, 0);
                for (let i = firstDay - 1; i >= 0; i--) {
                    const day = prevMonth.getDate() - i;
                    calendarHTML += `<div class="calendar-cell other-month"><div class="text-sm">${day}</div></div>`;
                }

                // Days of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(year, month, day);
                    const dateString = date.toISOString().split('T')[0];
                    const dayTasks = this.tasks.filter(task => task.dueDate === dateString);
                    const isToday = day === today.getDate() && month === today.getMonth() && year === today.getFullYear();

                    const taskDots = dayTasks.slice(0, 3).map(task => {
                        const colors = {
                            urgent: 'bg-red-500', high: 'bg-orange-500',
                            medium: 'bg-yellow-500', low: 'bg-green-500'
                        };
                        return `<div class="task-dot ${colors[task.priority]}" title="${task.title}"></div>`;
                    }).join('');

                    calendarHTML += `
                        <div class="calendar-cell ${isToday ? 'today' : ''}" onclick="taskManager.selectCalendarDate('${dateString}')">
                            <div class="text-sm font-medium mb-1">${day}</div>
                            <div class="flex flex-wrap">
                                ${taskDots}
                                ${dayTasks.length > 3 ? `<div class="text-xs text-secondary">+${dayTasks.length - 3}</div>` : ''}
                            </div>
                        </div>
                    `;
                }

                // Fill remaining cells
                const totalCells = Math.ceil((firstDay + daysInMonth) / 7) * 7;
                const remainingCells = totalCells - (firstDay + daysInMonth);
                for (let day = 1; day <= remainingCells; day++) {
                    calendarHTML += `<div class="calendar-cell other-month"><div class="text-sm">${day}</div></div>`;
                }

                calendar.innerHTML = calendarHTML;
            }

            selectDate(dateString) {
                // Filter tasks by selected date
                document.getElementById('searchInput').value = '';
                document.getElementById('categoryFilter').value = '';
                document.getElementById('priorityFilter').value = '';
                document.getElementById('statusFilter').value = '';
                
                // Show tasks for this date
                const tasksForDate = this.tasks.filter(task => task.dueDate === dateString);
                if (tasksForDate.length > 0) {
                    this.showNotification(`Found ${tasksForDate.length} task(s) for ${new Date(dateString).toLocaleDateString()}`, 'info');
                }
            }

            selectCalendarDate(dateString) {
                this.selectDate(dateString);
                this.switchView('dashboard');
            }

            startReminderCheck() {
                this.reminderInterval = setInterval(() => {
                    this.checkReminders();
                }, 60000); // Check every minute
                
                // Initial check
                this.checkReminders();
            }

            checkReminders() {
                const now = new Date();
                const upcomingReminders = this.getUpcomingReminders();
                
                upcomingReminders.forEach(task => {
                    if (task.dueDate && task.dueTime) {
                        const dueDateTime = new Date(task.dueDate + 'T' + task.dueTime);
                        const reminderTime = new Date(dueDateTime.getTime() - (task.reminderMinutes * 60000));
                        
                        if (now >= reminderTime && now < dueDateTime) {
                            this.showReminder(task);
                        }
                    }
                });
                
                this.updateRemindersList();
            }

            getUpcomingReminders() {
                const now = new Date();
                const next24Hours = new Date(now.getTime() + (24 * 60 * 60 * 1000));
                
                return this.tasks.filter(task => {
                    if (!task.dueDate || task.completed) return false;
                    
                    const dueDate = new Date(task.dueDate + (task.dueTime ? 'T' + task.dueTime : ''));
                    return dueDate >= now && dueDate <= next24Hours;
                }).sort((a, b) => {
                    const aDate = new Date(a.dueDate + (a.dueTime ? 'T' + a.dueTime : ''));
                    const bDate = new Date(b.dueDate + (b.dueTime ? 'T' + b.dueTime : ''));
                    return aDate - bDate;
                });
            }

            updateRemindersList() {
                const remindersList = document.getElementById('remindersList');
                const noReminders = document.getElementById('noReminders');
                const upcomingReminders = this.getUpcomingReminders();
                
                if (upcomingReminders.length === 0) {
                    remindersList.innerHTML = '';
                    noReminders.classList.remove('hidden');
                    return;
                }
                
                noReminders.classList.add('hidden');
                remindersList.innerHTML = upcomingReminders.slice(0, 5).map(task => {
                    const dueDate = new Date(task.dueDate + (task.dueTime ? 'T' + task.dueTime : ''));
                    const timeUntil = this.getTimeUntil(dueDate);
                    
                    return `
                        <div class="flex items-center justify-between p-2 bg-yellow-50 rounded-lg">
                            <div class="flex-1">
                                <div class="text-sm font-medium text-primary">${task.title}</div>
                                <div class="text-xs text-secondary">${timeUntil}</div>
                            </div>
                            <button onclick="taskManager.showTaskDetail(${task.id})" 
                                    class="text-blue-600 hover:text-blue-800 text-sm">üëÅÔ∏è</button>
                        </div>
                    `;
                }).join('');
            }

            getTimeUntil(date) {
                const now = new Date();
                const diff = date - now;
                
                if (diff < 0) return 'Overdue';
                
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                if (hours > 24) {
                    const days = Math.floor(hours / 24);
                    return `${days} day${days > 1 ? 's' : ''}`;
                } else if (hours > 0) {
                    return `${hours}h ${minutes}m`;
                } else {
                    return `${minutes}m`;
                }
            }

            showReminder(task) {
                if (!this.settings.enableNotifications) return;
                
                const reminderText = `Task "${task.title}" is due ${task.dueTime ? 'at ' + task.dueTime : 'today'}`;
                document.getElementById('reminderText').textContent = reminderText;
                this.showModal('reminderModal');
                
                // Browser notification
                if (Notification.permission === 'granted') {
                    new Notification('Task Reminder', {
                        body: reminderText,
                        icon: 'üîî'
                    });
                }
                
                // Sound notification
                if (this.settings.enableSounds) {
                    // Create a simple beep sound using Web Audio API
                    try {
                        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.value = 800;
                        oscillator.type = 'sine';
                        
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.5);
                    } catch (e) {
                        console.log('Audio not supported');
                    }
                }
            }

            snoozeReminder() {
                // Snooze for 5 minutes
                this.hideModal('reminderModal');
                this.showNotification('Reminder snoozed for 5 minutes', 'info');
            }

            dismissReminder() {
                this.hideModal('reminderModal');
            }

            showReminders() {
                const upcomingReminders = this.getUpcomingReminders();
                if (upcomingReminders.length === 0) {
                    this.showNotification('No upcoming reminders', 'info');
                } else {
                    this.showNotification(`You have ${upcomingReminders.length} upcoming reminder(s)`, 'info');
                }
            }

            requestNotificationPermission() {
                if ('Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }
            }

            renderCharts() {
                this.renderCategoryChart();
                this.renderPriorityChart();
                this.renderTrendChart();
                this.renderTimeChart();
            }

            renderCategoryChart() {
                const ctx = document.getElementById('categoryChart').getContext('2d');
                
                // Destroy existing chart
                if (this.charts.category) {
                    this.charts.category.destroy();
                }
                
                const categories = {};
                this.tasks.forEach(task => {
                    categories[task.category] = (categories[task.category] || 0) + 1;
                });

                const categoryLabels = {
                    work: 'üíº Work', personal: 'üë§ Personal', health: '‚ù§Ô∏è Health',
                    home: 'üè† Home', travel: '‚úàÔ∏è Travel', learning: 'üìö Learning',
                    finance: 'üí∞ Finance', shopping: 'üõí Shopping'
                };

                this.charts.category = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(categories).map(cat => categoryLabels[cat] || cat),
                        datasets: [{
                            data: Object.values(categories),
                            backgroundColor: [
                                '#3b82f6', '#ef4444', '#10b981', '#f59e0b',
                                '#8b5cf6', '#06b6d4', '#f97316', '#84cc16'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            renderPriorityChart() {
                const ctx = document.getElementById('priorityChart').getContext('2d');
                
                if (this.charts.priority) {
                    this.charts.priority.destroy();
                }
                
                const priorities = { urgent: 0, high: 0, medium: 0, low: 0 };
                this.tasks.forEach(task => {
                    priorities[task.priority]++;
                });

                this.charts.priority = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['üî¥ Urgent', 'üü† High', 'üü° Medium', 'üü¢ Low'],
                        datasets: [{
                            label: 'Tasks',
                            data: [priorities.urgent, priorities.high, priorities.medium, priorities.low],
                            backgroundColor: ['#ef4444', '#f97316', '#f59e0b', '#10b981']
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { stepSize: 1 }
                            }
                        }
                    }
                });
            }

            renderTrendChart() {
                const ctx = document.getElementById('trendChart').getContext('2d');
                
                if (this.charts.trend) {
                    this.charts.trend.destroy();
                }
                
                // Get last 7 days
                const last7Days = [];
                const completedByDay = [];
                const createdByDay = [];
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    const dateString = date.toISOString().split('T')[0];
                    
                    last7Days.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
                    
                    const completed = this.tasks.filter(task => 
                        task.completedAt && task.completedAt.split('T')[0] === dateString
                    ).length;
                    
                    const created = this.tasks.filter(task => 
                        task.createdAt.split('T')[0] === dateString
                    ).length;
                    
                    completedByDay.push(completed);
                    createdByDay.push(created);
                }

                this.charts.trend = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: last7Days,
                        datasets: [{
                            label: 'Completed',
                            data: completedByDay,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'Created',
                            data: createdByDay,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { stepSize: 1 }
                            }
                        }
                    }
                });
            }

            renderTimeChart() {
                const ctx = document.getElementById('timeChart').getContext('2d');
                
                if (this.charts.time) {
                    this.charts.time.destroy();
                }
                
                const timeByCategory = {};
                this.tasks.forEach(task => {
                    if (task.timeSpent > 0) {
                        timeByCategory[task.category] = (timeByCategory[task.category] || 0) + task.timeSpent;
                    }
                });

                const categoryLabels = {
                    work: 'üíº Work', personal: 'üë§ Personal', health: '‚ù§Ô∏è Health',
                    home: 'üè† Home', travel: '‚úàÔ∏è Travel', learning: 'üìö Learning',
                    finance: 'üí∞ Finance', shopping: 'üõí Shopping'
                };

                this.charts.time = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: Object.keys(timeByCategory).map(cat => categoryLabels[cat] || cat),
                        datasets: [{
                            data: Object.values(timeByCategory),
                            backgroundColor: [
                                '#3b82f6', '#ef4444', '#10b981', '#f59e0b',
                                '#8b5cf6', '#06b6d4', '#f97316', '#84cc16'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.label + ': ' + context.parsed.toFixed(1) + 'h';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            loadSettings() {
                document.getElementById('enableNotifications').checked = this.settings.enableNotifications;
                document.getElementById('enableSounds').checked = this.settings.enableSounds;
                document.getElementById('defaultReminder').value = this.settings.defaultReminder;
            }

            saveSettings() {
                localStorage.setItem('settings', JSON.stringify(this.settings));
            }

            exportData() {
                const data = {
                    tasks: this.tasks,
                    settings: this.settings,
                    exportDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `task-manager-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showNotification('Data exported successfully!', 'success');
            }

            importData(file) {
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (data.tasks && Array.isArray(data.tasks)) {
                            if (confirm('This will replace all existing tasks. Continue?')) {
                                this.tasks = data.tasks;
                                if (data.settings) {
                                    this.settings = { ...this.settings, ...data.settings };
                                }
                                
                                this.saveTasks();
                                this.saveSettings();
                                this.loadSettings();
                                this.renderTasks();
                                this.updateProgress();
                                this.updateStats();
                                this.generateCalendar();
                                this.generateFullCalendar();
                                
                                this.showNotification('Data imported successfully!', 'success');
                            }
                        } else {
                            throw new Error('Invalid file format');
                        }
                    } catch (error) {
                        this.showNotification('Error importing data: Invalid file format', 'error');
                    }
                };
                reader.readAsText(file);
            }

            clearAllData() {
                if (confirm('This will permanently delete all tasks and settings. This action cannot be undone. Continue?')) {
                    if (confirm('Are you absolutely sure? This will delete everything!')) {
                        this.tasks = [];
                        this.settings = {
                            enableNotifications: true,
                            enableSounds: true,
                            defaultReminder: 15
                        };
                        
                        localStorage.removeItem('tasks');
                        localStorage.removeItem('settings');
                        
                        this.loadSettings();
                        this.renderTasks();
                        this.updateProgress();
                        this.updateStats();
                        this.generateCalendar();
                        this.generateFullCalendar();
                        
                        this.showNotification('All data cleared successfully!', 'success');
                    }
                }
            }

            addSampleTasks() {
                const sampleTasks = [
                    {
                        id: 1,
                        title: "Complete project proposal",
                        description: "Finish the Q4 project proposal with budget analysis",
                        category: "work",
                        priority: "high",
                        dueDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        dueTime: "17:00",
                        estimatedHours: 4,
                        reminderMinutes: 30,
                        subtasks: [
                            { id: 11, title: "Research market trends", completed: true },
                            { id: 12, title: "Create budget breakdown", completed: false },
                            { id: 13, title: "Review with team", completed: false }
                        ],
                        checklist: [
                            { id: 21, title: "Executive summary", completed: true },
                            { id: 22, title: "Financial projections", completed: false },
                            { id: 23, title: "Risk assessment", completed: false }
                        ],
                        status: 'in-progress',
                        progress: 40,
                        timeSpent: 2.5,
                        completed: false,
                        createdAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                        notes: []
                    },
                    {
                        id: 2,
                        title: "Morning workout routine",
                        description: "30 minutes cardio + strength training",
                        category: "health",
                        priority: "medium",
                        dueDate: new Date().toISOString().split('T')[0],
                        dueTime: "07:00",
                        estimatedHours: 1,
                        reminderMinutes: 15,
                        subtasks: [],
                        checklist: [
                            { id: 31, title: "10 min warm-up", completed: true },
                            { id: 32, title: "20 min cardio", completed: true },
                            { id: 33, title: "10 min cool-down", completed: true }
                        ],
                        status: 'completed',
                        progress: 100,
                        timeSpent: 1,
                        completed: true,
                        createdAt: new Date().toISOString(),
                        completedAt: new Date().toISOString(),
                        notes: []
                    },
                    {
                        id: 3,
                        title: "Buy groceries for the week",
                        description: "Weekly grocery shopping",
                        category: "shopping",
                        priority: "low",
                        dueDate: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        dueTime: "",
                        estimatedHours: 1.5,
                        reminderMinutes: 60,
                        subtasks: [],
                        checklist: [
                            { id: 41, title: "Fruits and vegetables", completed: false },
                            { id: 42, title: "Dairy products", completed: false },
                            { id: 43, title: "Meat and fish", completed: false },
                            { id: 44, title: "Pantry items", completed: false }
                        ],
                        status: 'pending',
                        progress: 0,
                        timeSpent: 0,
                        completed: false,
                        createdAt: new Date().toISOString(),
                        notes: []
                    }
                ];
                
                this.tasks = sampleTasks;
                this.saveTasks();
                this.renderTasks();
                this.updateProgress();
                this.updateStats();
            }

            showNotification(message, type = 'info') {
                const notifications = document.getElementById('notifications');
                const notification = document.createElement('div');
                
                const colors = {
                    success: 'bg-green-500',
                    error: 'bg-red-500',
                    info: 'bg-blue-500',
                    warning: 'bg-yellow-500'
                };

                notification.className = `notification ${colors[type]} text-white px-4 py-3 rounded-lg shadow-lg max-w-sm`;
                notification.innerHTML = `
                    <div class="flex items-center justify-between">
                        <span class="text-sm">${message}</span>
                        <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">√ó</button>
                    </div>
                `;

                notifications.appendChild(notification);

                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 5000);
            }

            saveTasks() {
                localStorage.setItem('tasks', JSON.stringify(this.tasks));
            }
        }

        // Initialize the advanced task manager
        const taskManager = new AdvancedTaskManager();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98498e9466dda7e4',t:'MTc1ODc5MzE5NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
